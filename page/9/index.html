<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"chaxxro.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="好记性不如烂键盘">
<meta property="og:type" content="website">
<meta property="og:title" content="也无风雨也无晴">
<meta property="og:url" content="https://chaxxro.github.io/page/9/index.html">
<meta property="og:site_name" content="也无风雨也无晴">
<meta property="og:description" content="好记性不如烂键盘">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="chaxxro">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://chaxxro.github.io/page/9/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/9/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>也无风雨也无晴</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">也无风雨也无晴</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">chaxxro</p>
  <div class="site-description" itemprop="description">好记性不如烂键盘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">408</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/19/Linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-perf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/19/Linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-perf/" class="post-title-link" itemprop="url">perf</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-19 11:16:41" itemprop="dateCreated datePublished" datetime="2023-06-19T11:16:41+08:00">2023-06-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-11 17:03:26" itemprop="dateModified" datetime="2024-03-11T17:03:26+08:00">2024-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux-%E5%91%BD%E4%BB%A4%E8%A1%8C/" itemprop="url" rel="index"><span itemprop="name">Linux 命令行</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>perf 是 performance 的缩写，是一个事件驱动的可观测性工具</p>
<h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><p><code>perf list</code> 查看支持事件，一般来说分为六类</p>
<ul>
<li><p>硬件事件，来自于 CPU 硬件监控计数器</p>
</li>
<li><p>软件事件，来自于内核计数器</p>
</li>
<li><p>内核追踪点事件，来自于内核中硬编码的静态指令点</p>
</li>
<li><p>USDT 事件，来自于用户程序的静态追踪点</p>
</li>
<li><p>动态追踪事件，来自于软件动态插桩</p>
</li>
<li><p>时许剖析，来自于通过 <code>perf record</code> 收集到的数据</p>
</li>
</ul>
<h3 id="软件事件"><a href="#软件事件" class="headerlink" title="软件事件"></a>软件事件</h3><ul>
<li><p>cpu-clock，cpu 执行的计数器</p>
</li>
<li><p>task-clock，某个任务在 cpu 上运行时的 clock 数</p>
</li>
<li><p>page-faults，缺页中断数</p>
</li>
<li><p>alignment-faults，对齐错误</p>
</li>
<li><p>context-switches，上下文切换数</p>
</li>
<li><p>cpu-migrations，任务在 cpu 间迁移数</p>
</li>
<li><p>minor-faults，缺页中断一部分，指的是访问在内存中但是没有映射到程序地址空间的页发生的错误</p>
</li>
<li><p>major-faults，缺页中断一部分，指的是访问不在内存中的页，需要磁盘参与进行换页的中断</p>
</li>
</ul>
<h3 id="硬件事件"><a href="#硬件事件" class="headerlink" title="硬件事件"></a>硬件事件</h3><ul>
<li><p>cache-misses，缓存不命中</p>
</li>
<li><p>branch-misses，分支预测失败</p>
</li>
<li><p>cpu-cycles，cpu 时钟情况</p>
</li>
<li><p>stalled_cycles_frontend，cpu 前端的停滞周期数</p>
</li>
<li><p>stalled_cycles_backend，cpu 后端的停滞周期数</p>
</li>
</ul>
<h2 id="计数"><a href="#计数" class="headerlink" title="计数"></a>计数</h2><p><code>perf stat</code> 来收集一些计数信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">perf <span class="built_in">stat</span> [-e &lt;EVENT&gt; | --event=EVENT] [-a] &lt;<span class="built_in">command</span>&gt;</span><br><span class="line">perf <span class="built_in">stat</span> [-e &lt;EVENT&gt; | --event=EVENT] [-a] — &lt;<span class="built_in">command</span>&gt; [&lt;options&gt;]</span><br><span class="line"></span><br><span class="line">-e, --event &lt;event&gt; 指定事件</span><br><span class="line">--filter &lt;filter&gt; 过滤事件</span><br><span class="line">-i 不统计子进程</span><br><span class="line">-a 对全部 CPU 进行计数</span><br><span class="line">-p 指定进程</span><br><span class="line">-t 指定线程</span><br><span class="line">-v 详细信息</span><br><span class="line">-I 指定事件间隔，单位毫秒，最小 100ms</span><br><span class="line">-r 重复运行，并显示平均信息</span><br></pre></td></tr></table></figure>

<h2 id="采样"><a href="#采样" class="headerlink" title="采样"></a>采样</h2><p><code>perf record</code> 和 <code>perf top</code> 对系统进行剖析</p>
<h3 id="perf-top"><a href="#perf-top" class="headerlink" title="perf top"></a>perf top</h3><p><code>perf top</code> 可以看到目前的 CPU 执行占比情况，该情况会随着时间刷新，这可以帮助快速的发现热点</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">perf top [-e &lt;EVENT&gt; | --event=EVENT] [&lt;options&gt;]</span><br><span class="line"></span><br><span class="line">-a 全系统采样</span><br><span class="line">-c 每采样 n 个事件记录一次</span><br><span class="line">-d 刷新间隔时间</span><br><span class="line">-e, --event &lt;event&gt; 指定事件</span><br><span class="line">-p 指定进程</span><br><span class="line">-t 指定线程</span><br></pre></td></tr></table></figure>

<img src="/2023/06/19/Linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-perf/01.png" class="">

<ul>
<li><p>Overhead 该符号的性能事件在所有采样事件中的比例</p>
</li>
<li><p>Shared 该函数或指令所在的动态共享对象，如内核、进程名、动态链接库</p>
</li>
<li><p>Object 动态共享对象类型，<code>.</code> 表示用户空间的可执行程序，<code>k</code> 内核空间</p>
</li>
<li><p>Symbol 符号名、函数名，函数名未知时用十六进制表示</p>
</li>
</ul>
<h3 id="perf-record"><a href="#perf-record" class="headerlink" title="perf record"></a>perf record</h3><p><code>perf record</code> 是把多个时间的 <code>perf top</code> 结果作为切片保存到一个文件里，从而得到一段时间里的执行情况，默认在当前目录下生成数据文件 perf.data</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">perf record [-e &lt;EVENT&gt; | --event=EVENT] [-l] [-a] &lt;<span class="built_in">command</span>&gt;</span><br><span class="line">perf record [-e &lt;EVENT&gt; | --event=EVENT] [-l] [-a] —- &lt;<span class="built_in">command</span>&gt; [&lt;options&gt;]</span><br><span class="line"></span><br><span class="line">-e, --event &lt;event&gt; 指定事件</span><br><span class="line">--filter &lt;filter&gt; 过滤事件</span><br><span class="line">-a 对全部 CPU 进行计数</span><br><span class="line">-p 指定进程</span><br><span class="line">-t 指定线程</span><br><span class="line">-f 覆盖已存在的数据文件</span><br><span class="line">-c 每采样 n 个事件记录一次</span><br><span class="line">-o 输出文件名</span><br><span class="line">-g 保存调用栈</span><br><span class="line">-s 每个线程都统计</span><br><span class="line">-F, --freq &lt;n&gt; 采样频率</span><br></pre></td></tr></table></figure>

<p><code>perf record</code> 得到的结果数据是无法直接读取的，可以用 <code>perf script</code> 将其转换成可读文件，或者直接用 <code>perf report</code> 进行图形化展示</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/14/Bazel-WorkspaceRule/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/14/Bazel-WorkspaceRule/" class="post-title-link" itemprop="url">WorkspaceRule</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-14 14:39:09" itemprop="dateCreated datePublished" datetime="2023-06-14T14:39:09+08:00">2023-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-11 17:03:26" itemprop="dateModified" datetime="2024-03-11T17:03:26+08:00">2024-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Bazel/" itemprop="url" rel="index"><span itemprop="name">Bazel</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>WORKSPACE 文件中的 rule 主要是为了引入外部依赖，其主要分为原生 rule 和 Starlark rule</p>
<h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><p>原生 rule</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind(name, actual, compatible_with, deprecation, distribs, features, licenses, restricted_to, tags, testonly, visibility)</span><br></pre></td></tr></table></figure>

<p><code>bind</code> 用于给 target 在 <code>//external</code> 包中创建一个别名</p>
<p><code>//external</code> 不是常规的包，可以把它看成一个包含所有绑定目标的虚拟包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">bind(</span><br><span class="line">    name = &quot;javacc-latest&quot;,</span><br><span class="line">    actual = &quot;//third_party/javacc-v2&quot;,</span><br><span class="line">)</span><br><span class="line"># 使用 bind 后可以用 //external:javacc-latest 来替代 //third_party/javacc-v2</span><br><span class="line"></span><br><span class="line"># 引入外部包</span><br><span class="line">bind(</span><br><span class="line">    name = &quot;openssl&quot;,</span><br><span class="line">    actual = &quot;@my-ssl//src:openssl-lib&quot;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>bind</code> 是不推荐使用的</p>
<h2 id="local-repository"><a href="#local-repository" class="headerlink" title="local_repository"></a>local_repository</h2><p>原生 rule</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">local_repository(name, path, repo_mapping)</span><br></pre></td></tr></table></figure>

<p>引入一个本地目录中的 Bazel 仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">local_repository(</span><br><span class="line">    name = &quot;my-ssl&quot;,</span><br><span class="line">    path = &quot;/home/user/ssl&quot;,</span><br><span class="line">)</span><br><span class="line"># 之后使用 /home/user/ssl 中的 target 时可以用 @my-ssl//src:openssl-lib 表示</span><br></pre></td></tr></table></figure>

<h2 id="new-local-repository"><a href="#new-local-repository" class="headerlink" title="new_local_repository"></a>new_local_repository</h2><p>原生 rule</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new_local_repository(name, build_file, build_file_content, path, repo_mapping, workspace_file, workspace_file_content)</span><br></pre></td></tr></table></figure>

<p>引入一个本地目录中的非 Bazel 仓库或文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># WORKSPACE</span><br><span class="line">new_local_repository(</span><br><span class="line">    name = &quot;my-ssl&quot;,</span><br><span class="line">    path = &quot;/home/user/ssl&quot;,</span><br><span class="line">    build_file = &quot;BUILD.my-ssl&quot;,</span><br><span class="line">)</span><br><span class="line"># BUILD.my-ssl</span><br><span class="line">java_library(</span><br><span class="line">    name = &quot;openssl&quot;,</span><br><span class="line">    srcs = glob([&#x27;*.java&#x27;])</span><br><span class="line">    visibility = [&quot;//visibility:public&quot;],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># WORKSPACE</span><br><span class="line">new_local_repository(</span><br><span class="line">    name = &quot;piano&quot;,</span><br><span class="line">    path = &quot;/home/username/Downloads/piano.jar&quot;,</span><br><span class="line">    build_file = &quot;BUILD.piano&quot;,</span><br><span class="line">)</span><br><span class="line"># BUILD.plano</span><br><span class="line">java_import(</span><br><span class="line">    name = &quot;play-music&quot;,</span><br><span class="line">    jars = [&quot;piano.jar&quot;],</span><br><span class="line">    visibility = [&quot;//visibility:public&quot;],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="git-repository"><a href="#git-repository" class="headerlink" title="git_repository"></a>git_repository</h2><p>Starlark rule，需要 <code>load(@bazel_tools//tools/build_defs/repo:git.bzl)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git_repository(name, branch, commit, init_submodules, patch_args, patch_cmds, patch_cmds_win,</span><br><span class="line">               patch_tool, patches, recursive_init_submodules, remote, shallow_since, strip_prefix,</span><br><span class="line">               tag, verbose)</span><br></pre></td></tr></table></figure>

<p>克隆一个外部 Bazel 仓库</p>
<h2 id="new-git-repository"><a href="#new-git-repository" class="headerlink" title="new_git_repository"></a>new_git_repository</h2><p>Starlark rule，需要 <code>load(@bazel_tools//tools/build_defs/repo:git.bzl)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">new_git_repository(name, branch, build_file, build_file_content, commit, init_submodules,</span><br><span class="line">                   patch_args, patch_cmds, patch_cmds_win, patch_tool, patches,</span><br><span class="line">                   recursive_init_submodules, remote, shallow_since, strip_prefix, tag, verbose,</span><br><span class="line">                   workspace_file, workspace_file_content)</span><br></pre></td></tr></table></figure>

<p>克隆一个外部非 Bazel 仓库</p>
<h2 id="http-archive"><a href="#http-archive" class="headerlink" title="http_archive"></a>http_archive</h2><p>Starlark rule，需要 <code>load(@bazel_tools//tools/build_defs/repo:http.bzl)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http_archive(name, auth_patterns, build_file, build_file_content, canonical_id, netrc, patch_args,</span><br><span class="line">             patch_cmds, patch_cmds_win, patch_tool, patches, sha256, strip_prefix, type, url, urls,</span><br><span class="line">             workspace_file, workspace_file_content)</span><br></pre></td></tr></table></figure>

<p>下载一个压缩的 Bazel 仓库，对其解压后引入该仓库</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/12/Bazel-%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/12/Bazel-%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5/" class="post-title-link" itemprop="url">几个重要概念</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-12 20:12:32" itemprop="dateCreated datePublished" datetime="2023-06-12T20:12:32+08:00">2023-06-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-11 17:03:26" itemprop="dateModified" datetime="2024-03-11T17:03:26+08:00">2024-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Bazel/" itemprop="url" rel="index"><span itemprop="name">Bazel</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="工作区"><a href="#工作区" class="headerlink" title="工作区"></a>工作区</h2><p>工作区包括项目源文件、Bazel 构建产物和 Bazel 需要的文件</p>
<p>{ % asset_img 01.png % }</p>
<p>Bazel 所需文件包括：</p>
<ul>
<li><p>WORKSPACE 文件，位于项目目录结构的根目录</p>
</li>
<li><p>一个或多个 BUILD 文件，工作区中包含 BUILD 文件的目录被视为是一个包，BUILD 文件表示如何构建这个包</p>
</li>
</ul>
<p>当 Bazel 构建项目时，所有输入和依赖项必须在同一个工作区中</p>
<p>位于不同工作区中的文件彼此独立，除非链接进本工作区</p>
<h2 id="WORKSPACE-文件"><a href="#WORKSPACE-文件" class="headerlink" title="WORKSPACE 文件"></a>WORKSPACE 文件</h2><p>WORKSPACE 文件标明当前目录是项目的根目录，Bazel 会忽略子目录中的 WORKSPACE 文件，因为其他 WORKSPACE 文件会当视为其他项目的根目录</p>
<p>WORKSPACE 主要用于声明构建所需的外部依赖</p>
<p>Bazel 也支持将 WORKSPACE 文件命名为 WORKSPACE.bazel，如果两种命名同时存在时，Bazel 会使用 WORKSPACE.bazel，因为它优先级更高</p>
<p>项目根目录可以使用 <code>@</code> 替代</p>
<h2 id="包"><a href="#包" class="headerlink" title="包"></a>包</h2><p>包是 BUILD 文件或 BUILD.bazel 文件所在的目录，它包括目录中的所有文件</p>
<h2 id="BUILD-文件"><a href="#BUILD-文件" class="headerlink" title="BUILD 文件"></a>BUILD 文件</h2><p>一个 BUILD 文件包含几种不同类型的 Bazel 指令，最重要的指令是构建规则，它告诉 Bazel 如何构建所需的输出</p>
<p>BUILD 文件中构建规则作用于 target，该 target 对应一组特定的源文件和依赖项</p>
<p>一个 target 还可以依赖其他 target</p>
<p>一个 target 的默认可见性是当前 BUILD 文件，即当前目录包中，但可以显式地指定 target 的可见性</p>
<p>BUILD 文件使用 Starlark 语言编写，不允许有函数的定义、<code>for</code> 语句、<code>if</code> 语句，可以有列表推导和 <code>if</code> 表达式，函数应该被定义在 .bzl 文件中，而且 <code>*args</code> 和 <code> **kwargs</code> 不允许使用，除非显示列出所有参数</p>
<h2 id="target-名称"><a href="#target-名称" class="headerlink" title="target 名称"></a>target 名称</h2><p>在 BUILD 文件和命令行中，target 名称格式是 <code>@myrepo//path_to_package:target_name</code></p>
<ul>
<li><p>如果引用的 target 跟当前 target 在同一工作区，可以使用 <code>//path_to_package:target_name</code></p>
</li>
<li><p>如果引用的 target 在当前 BUILD 目录中，可以直接使用 <code>:target_name</code></p>
</li>
<li><p>如果引用的 target 在 WORKSPACE 目录中，可以直接使用 <code>//:target_name</code></p>
</li>
</ul>
<h2 id="加载扩展"><a href="#加载扩展" class="headerlink" title="加载扩展"></a>加载扩展</h2><p>扩展需要写在 .bzl 文件中，通过 <code>load</code> 引入</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/08/CMake-%E5%B7%A5%E7%A8%8B%E5%91%BD%E4%BB%A4-link-directories/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/08/CMake-%E5%B7%A5%E7%A8%8B%E5%91%BD%E4%BB%A4-link-directories/" class="post-title-link" itemprop="url">link_directories</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-08 21:22:05" itemprop="dateCreated datePublished" datetime="2023-06-08T21:22:05+08:00">2023-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-11 17:03:26" itemprop="dateModified" datetime="2024-03-11T17:03:26+08:00">2024-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/cmake/" itemprop="url" rel="index"><span itemprop="name">cmake</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">link_directories</span>([AFTER|BEFORE] [SYSTEM] dir1 [dir2 ...])</span><br></pre></td></tr></table></figure>

<p>将 dir 放入搜索库文件地址列表 <code>LINK_DIRECTORIES</code> 中，插入位置默认是末尾 <code>AFTER</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/08/CMake-%E5%B7%A5%E7%A8%8B%E5%91%BD%E4%BB%A4-include-directories/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/08/CMake-%E5%B7%A5%E7%A8%8B%E5%91%BD%E4%BB%A4-include-directories/" class="post-title-link" itemprop="url">include_direcotries</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-08 21:21:55" itemprop="dateCreated datePublished" datetime="2023-06-08T21:21:55+08:00">2023-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-11 17:03:26" itemprop="dateModified" datetime="2024-03-11T17:03:26+08:00">2024-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/cmake/" itemprop="url" rel="index"><span itemprop="name">cmake</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_directories</span>([AFTER|BEFORE] [SYSTEM] dir1 [dir2 ...])</span><br></pre></td></tr></table></figure>

<p>将 dir 放入搜索头文件地址列表 <code>INCLUDE_DIRECTORIES</code> 中，插入位置默认是末尾 <code>AFTER</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-Proactor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-Proactor/" class="post-title-link" itemprop="url">Proactor</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-08 20:40:36" itemprop="dateCreated datePublished" datetime="2023-06-08T20:40:36+08:00">2023-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-11 17:03:26" itemprop="dateModified" datetime="2024-03-11T17:03:26+08:00">2024-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">网络编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Proactor 采用了异步 IO 技术，所以被称为异步网络模型</p>
<ul>
<li><p>Reactor 是非阻塞同步网络模式，感知的是就绪可读写事件</p>
</li>
<li><p>Proactor 是异步网络模式，感知的是已完成的读写事件</p>
</li>
</ul>
<p>无论是 Reactor 还是 Proactor，都是一种基于事件分发的网络编程模式，区别在于 Reactor 模式是基于待完成的 IO 事件，而 Proactor 模式则是基于已完成的 IO 事件</p>
<p>Proactor 模式中，整个内核的数据处理过程，包括内核将数据从网络物理设备（网卡）读取到内核缓存区、将内核缓冲区的数据复制到用户缓冲区，用户程序都不需要阻塞</p>
<img src="/2023/06/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-Proactor/01.png" class="">

<p>Proactor 性能高于 Reactor，但依赖操作系统对异步 IO 的支持</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-Reactor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-Reactor/" class="post-title-link" itemprop="url">Reactor</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-08 20:40:24" itemprop="dateCreated datePublished" datetime="2023-06-08T20:40:24+08:00">2023-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-11 17:03:26" itemprop="dateModified" datetime="2024-03-11T17:03:26+08:00">2024-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">网络编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Reactor 模式其实就是利用面向对象的思想对非阻塞同步 IO 复用的封装，即 IO 多路复用监听事件，收到事件后根据事件类型分配给某个线程或进程</p>
<p>Reactor 模式主要由 Reactor 和处理资源池组成：</p>
<ul>
<li><p>Reactor 负责监听和分发事件，事件包括连接和读写</p>
</li>
<li><p>处理资源池负责处理事件</p>
</li>
</ul>
<p>Reactor 模式是灵活多变的，可根据不同场景特殊设计：</p>
<ul>
<li><p>Reactor 数量灵活</p>
</li>
<li><p>处理资源池可以是单个进程、线程，也可以是多个进程、线程</p>
</li>
</ul>
<h2 id="单-Reactor-单线程模型"><a href="#单-Reactor-单线程模型" class="headerlink" title="单 Reactor 单线程模型"></a>单 Reactor 单线程模型</h2><img src="/2023/06/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-Reactor/01.png" class="">

<p>单 Reactor 单线程模型中有 Reactor、Acceptor、Handler 三个对象</p>
<ul>
<li><p>Reactor 对象负责监听和分发事件</p>
</li>
<li><p>Acceptor 对象负责处理新连接</p>
</li>
<li><p>Handler 对象负责处理业务</p>
</li>
</ul>
<p>整体流程：</p>
<ol>
<li><p>Reactor 对象通过 IO 复用监控事件，收到事件后通过事件类型进行转发</p>
</li>
<li><p>如果是连接建立的事件，则由 Acceptor 对象进行处理，并创建 Handler 对象负责处理后续事件</p>
</li>
<li><p>如果不是建立连接事件，则交由当前连接对应的 Handler 进行处理</p>
</li>
<li><p>Handler 通过 <code>read</code>、业务处理、<code>send</code> 完成完整业务流程</p>
</li>
</ol>
<p>单 Reactor 单线程模型只是在代码上进行了组件的区分，但是整体操作还是单线程，不能充分利用硬件资源，并且当业务处理耗时较长时，会造成响应延迟</p>
<p>单 Reactor 单线程的方案不适用计算机密集型的场景，只适用于业务处理非常快速的场景</p>
<h2 id="单-Reactor-多线程模型"><a href="#单-Reactor-多线程模型" class="headerlink" title="单 Reactor 多线程模型"></a>单 Reactor 多线程模型</h2><img src="/2023/06/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-Reactor/02.png" class="">

<ol>
<li><p>Reactor 对象通过 IO 复用监控事件，收到事件后通过事件类型进行转发</p>
</li>
<li><p>如果是连接建立的事件，则由 Acceptor 对象进行处理，并创建 Handler 对象负责处理后续事件</p>
</li>
<li><p>如果不是建立连接事件，则交由当前连接对应的 Handler 进行处理</p>
</li>
<li><p>Handler 对象不再负责业务处理，只负责接收、发送数据，Handler 通过 <code>read</code> 读取数据后会分发给子线程 Processor 对象进行业务处理</p>
</li>
<li><p>子线程 Processor 完成业务处理后，将结果发给主线程中的 Handler 对象进行处理</p>
</li>
<li><p>Handler 对象收到结果后通过 <code>send</code> 将结果返回</p>
</li>
</ol>
<p>将业务处理交由线程池来处理，使得 Reactor 能更专注的做事件分发工作了，提升整个应用的吞吐</p>
<p>又因为 Reactor 承担了所有事件的监听和响应，且只在主线程中运行，所以当面对瞬间高并发场景时容易成为性能瓶颈</p>
<h2 id="主从-Reactor-多线程模型"><a href="#主从-Reactor-多线程模型" class="headerlink" title="主从 Reactor 多线程模型"></a>主从 Reactor 多线程模型</h2><img src="/2023/06/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-Reactor/03.png" class="">

<ol>
<li><p>主线程中的 MainReactor 对象通过 IO 复用监控连接事件，收到事件后通过 Acceptor 对象将新连接分配给子线程的 SubReactor</p>
</li>
<li><p>子线程中的 SubReactor 对象将接收的新连接加入自己的 IO 复用中继续监控，并创建一个 Handler 对象处理后续事件</p>
</li>
<li><p>当有新事件发生时，由 SubReactor 对象调用相应 Handler 对象进行处理</p>
</li>
<li><p>Handler 对象通过 <code>read</code>、业务处理、<code>send</code> 完成完整业务处理</p>
</li>
</ol>
<p>主从 Reactor 多线程模型中，主线程和子线程分工明确，主线程只负责接收新连接，子线程负责完成后续的业务处理，子线程处理完成后无须返回数据，直接就可以在子线程中将结果返回</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/08/%E5%B8%B8%E8%A7%81%E6%A6%82%E5%BF%B5-rpc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/08/%E5%B8%B8%E8%A7%81%E6%A6%82%E5%BF%B5-rpc/" class="post-title-link" itemprop="url">rpc</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-08 10:19:27" itemprop="dateCreated datePublished" datetime="2023-06-08T10:19:27+08:00">2023-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-11 17:03:26" itemprop="dateModified" datetime="2024-03-11T17:03:26+08:00">2024-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B8%B8%E8%A7%81%E6%A6%82%E5%BF%B5/" itemprop="url" rel="index"><span itemprop="name">常见概念</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>从 rpc 的调用关系看，分为客户端和服务端</p>
<h2 id="路由标识"><a href="#路由标识" class="headerlink" title="路由标识"></a>路由标识</h2><p>一个服务的地址可以看作是 IP + Port + 协议</p>
<p>从服务寻址角度看，服务需要一个路由标识来获取服务的地址</p>
<p>路由标识必须全局唯一，且一般通过名字服务进行管理，所以路由标识也叫服务名或 Naming Service</p>
<p>客户端通过路由标识向名字服务获取服务地址</p>
<h2 id="接口标识"><a href="#接口标识" class="headerlink" title="接口标识"></a>接口标识</h2><p>rpc 调用接口也需要一个全剧唯一标识，称为接口标识或 RPC Name</p>
<p>利用 pb 自动生成接口时，接口标识格式可使用 <code>/package.proto_service/method</code></p>
<ul>
<li><p>package 对应 pb 中的 package，可以理解为一个支持多级的名字空间，用来防止接口命名冲突</p>
</li>
<li><p>proto_service 对应 pb 中的 service，是一组 rpc 方法的集合，它是对接口的一个逻辑分组</p>
</li>
<li><p>method 对应 pb 中的 rpc 方法，每个 method 必须且只能属于一个 proto_service，一个proto_service 允许定义多个 method</p>
</li>
</ul>
<h2 id="接口映射"><a href="#接口映射" class="headerlink" title="接口映射"></a>接口映射</h2><p>proto_service 负责定义 rpc 接口的定义和归类，Naming Service 负责网络连接和协议处理</p>
<p>需要把 proto_service 和 Naming Service 关联起来，通过把 proto_service 注册到 Naming Service 来完成服务的组装</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/07/pb-%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/07/pb-%E8%AF%AD%E6%B3%95/" class="post-title-link" itemprop="url">pb 语法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-07 16:30:30" itemprop="dateCreated datePublished" datetime="2023-06-07T16:30:30+08:00">2023-06-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-11 17:03:26" itemprop="dateModified" datetime="2024-03-11T17:03:26+08:00">2024-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/pb/" itemprop="url" rel="index"><span itemprop="name">pb</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="定义消息体"><a href="#定义消息体" class="headerlink" title="定义消息体"></a>定义消息体</h2><figure class="highlight pb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span><span class="comment">;</span></span><br><span class="line"></span><br><span class="line">message SearchRequest &#123;</span><br><span class="line">  string query = 1<span class="comment">;</span></span><br><span class="line">  int32 page_number = 2<span class="comment">;</span></span><br><span class="line">  int32 results_per_page = 3<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第一行必须指明当前使用 <code>proto3</code> 还是 <code>proto2</code>，默认 <code>proto2</code></p>
<h2 id="字段编号"><a href="#字段编号" class="headerlink" title="字段编号"></a>字段编号</h2><ul>
<li><p>每个字段必须有一个唯一的字段编号，范围在 1-536870911，其中 19000-19999 是 pb 内部使用的编号</p>
</li>
<li><p>字段编号一旦使用就不允许修改</p>
</li>
<li><p>不允许从保留列表中取编号出来复用编号</p>
</li>
</ul>
<h2 id="字段标签"><a href="#字段标签" class="headerlink" title="字段标签"></a>字段标签</h2><h3 id="optional"><a href="#optional" class="headerlink" title="optional"></a>optional</h3><p><code>optional</code> 字段有两种状态</p>
<ol>
<li><p>字段被显式设置，它将被序列化</p>
</li>
<li><p>字段未显式设置，它将使用默认值，并且不进行序列化</p>
</li>
</ol>
<p>有方法知道 <code>optional</code> 字段是否被显式设置</p>
<h3 id="repeated"><a href="#repeated" class="headerlink" title="repeated"></a>repeated</h3><p><code>repeated</code> 字段可以重复 0 次或多次，重复值的顺序将被保留段，类似于列表</p>
<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p><code>map</code> 是一个 kv 结构，其编码方式跟 <code>repeated</code> 相同</p>
<p><code>map</code> 的 key 只支持整形和字符串，value 不支持 <code>map</code></p>
<figure class="highlight pb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">message Test6 &#123;</span><br><span class="line">  map&lt;string, int32&gt; g = 7<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">// same as</span><br><span class="line">message Test6 &#123;</span><br><span class="line">  message g_Entry &#123;</span><br><span class="line">    optional string key = 1<span class="comment">;</span></span><br><span class="line">    optional int32 value = 2<span class="comment">;</span></span><br><span class="line">  &#125;</span><br><span class="line">  repeated g_Entry g = 7<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="implicit-field-presence"><a href="#implicit-field-presence" class="headerlink" title="implicit field presence"></a>implicit field presence</h3><p>如果不显式指定标签则默认的标签是隐式字段，隐式字段不可显式指定</p>
<p>一个格式良好的消息体最多只能有一个隐式字段</p>
<h2 id="删除字段"><a href="#删除字段" class="headerlink" title="删除字段"></a>删除字段</h2><p>删除字段后，必须使用 <code>reserve</code> 处理被删除的字段编号，避免后续继续使用该编号</p>
<p>为了保证 json 和文本功能后续能正常使用，还需要 <code>reserved</code> 字段名</p>
<figure class="highlight pb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">message Foo &#123;</span><br><span class="line">  reserved 2, 15, 9 to 11<span class="comment">;</span></span><br><span class="line">  reserved <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="基础数据类型"><a href="#基础数据类型" class="headerlink" title="基础数据类型"></a>基础数据类型</h2><table>
<thead>
<tr>
<th>type</th>
<th>C++ 类型</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>double</td>
<td>double</td>
<td></td>
</tr>
<tr>
<td>float</td>
<td>float</td>
<td></td>
</tr>
<tr>
<td>int32</td>
<td>int32</td>
<td>变长，处理负数低效</td>
</tr>
<tr>
<td>int64</td>
<td>int64</td>
<td>变长，处理负数低效</td>
</tr>
<tr>
<td>uint32</td>
<td>uint32</td>
<td>变长</td>
</tr>
<tr>
<td>uint64</td>
<td>uint64</td>
<td>变长</td>
</tr>
<tr>
<td>sint32</td>
<td>int32</td>
<td>变长，处理负数高效</td>
</tr>
<tr>
<td>sint64</td>
<td>int64</td>
<td>变长，处理负数高效</td>
</tr>
<tr>
<td>fixed32</td>
<td>uint32</td>
<td>定长，处理大数高效</td>
</tr>
<tr>
<td>fixed64</td>
<td>uint64</td>
<td>定长，处理大数高效</td>
</tr>
<tr>
<td>sfixed32</td>
<td>int32</td>
<td>定长</td>
</tr>
<tr>
<td>sfixed64</td>
<td>int64</td>
<td>定长</td>
</tr>
<tr>
<td>bool</td>
<td>bool</td>
<td></td>
</tr>
<tr>
<td>string</td>
<td>string</td>
<td>必须 utf-8 或 ASCII 编码，长度不超过 2^32</td>
</tr>
<tr>
<td>bytes</td>
<td>string</td>
<td>长度不超过 2^32</td>
</tr>
</tbody></table>
<h2 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h2><figure class="highlight pb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">enum Corpus &#123;</span><br><span class="line">  CORPUS_UNSPECIFIED = 0<span class="comment">;</span></span><br><span class="line">  CORPUS_UNIVERSAL = 1<span class="comment">;</span></span><br><span class="line">  CORPUS_WEB = 2<span class="comment">;</span></span><br><span class="line">  CORPUS_IMAGES = 3<span class="comment">;</span></span><br><span class="line">  CORPUS_LOCAL = 4<span class="comment">;</span></span><br><span class="line">  CORPUS_NEWS = 5<span class="comment">;</span></span><br><span class="line">  CORPUS_PRODUCTS = 6<span class="comment">;</span></span><br><span class="line">  CORPUS_VIDEO = 7<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum EnumAllowingAlias &#123;</span><br><span class="line">  option allow_alias = true<span class="comment">;</span></span><br><span class="line">  EAA_UNSPECIFIED = 0<span class="comment">;</span></span><br><span class="line">  EAA_STARTED = 1<span class="comment">;</span></span><br><span class="line">  EAA_RUNNING = 1<span class="comment">;</span></span><br><span class="line">  EAA_FINISHED = 2<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum EnumNotAllowingAlias &#123;</span><br><span class="line">  ENAA_UNSPECIFIED = 0<span class="comment">;</span></span><br><span class="line">  ENAA_STARTED = 1<span class="comment">;</span></span><br><span class="line">  // ENAA_RUNNING = 1<span class="comment">;  // Uncommenting this line will cause a warning message.</span></span><br><span class="line">  ENAA_FINISHED = 2<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>枚举的第一个元素必须是 0</p>
</li>
<li><p>默认一个枚举里不允许有相同值的不同字段，使用 <code>option allow_alias = true</code> 时允许不同字段有相同值</p>
</li>
<li><p>枚举值底层使用 32 位整形，所以不推荐使用负数，并且处理负数的效率较低</p>
</li>
<li><p>反序列化时，不被识别的枚举值将被保留，其值取决于编程语言本身</p>
</li>
</ul>
<p>同删除字段一样，可以将 <code>reserved</code> 应用在枚举上，来避免后续使用删除的枚举值</p>
<figure class="highlight pb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum Foo &#123;</span><br><span class="line">  reserved 2, 15, 9 to 11, 40 to max<span class="comment">;</span></span><br><span class="line">  reserved <span class="string">&quot;FOO&quot;</span>, <span class="string">&quot;BAR&quot;</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="oneof"><a href="#oneof" class="headerlink" title="oneof"></a>oneof</h2><p>类似于 C++ 的 <code>union</code>，但每次设置时都会清理所有数据再赋值</p>
<p><code>oneof</code> 中不允许使用 <code>map</code> 和 <code>repeated</code>，它本身也不允许使用 <code>repeated</code></p>
<figure class="highlight pb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">message SampleMessage &#123;</span><br><span class="line">  oneof test_oneof &#123;</span><br><span class="line">    string name = 4<span class="comment">;</span></span><br><span class="line">    SubMessage sub_message = 9<span class="comment">;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Any"><a href="#Any" class="headerlink" title="Any"></a>Any</h2><p><code>Any</code> 类型允许用户使用过一个没有 .proto 定义的类型</p>
<p>使用 <code>Any</code> 需要导入 google&#x2F;protobuf&#x2F;any.proto</p>
<figure class="highlight pb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import <span class="string">&quot;google/protobuf/any.proto&quot;</span><span class="comment">;</span></span><br><span class="line"></span><br><span class="line">message ErrorStatus &#123;</span><br><span class="line">  string message = 1<span class="comment">;</span></span><br><span class="line">  repeated google.protobuf.Any details = 2<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Storing an arbitrary message type in Any.</span></span><br><span class="line">NetworkErrorDetails details = ...;</span><br><span class="line">ErrorStatus status;</span><br><span class="line">status.<span class="built_in">add_details</span>()-&gt;<span class="built_in">PackFrom</span>(details);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reading an arbitrary message from Any.</span></span><br><span class="line">ErrorStatus status = ...;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">const</span> google::protobuf::Any&amp; detail : status.<span class="built_in">details</span>()) &#123;</span><br><span class="line">  <span class="keyword">if</span> (detail.<span class="built_in">Is</span>&lt;NetworkErrorDetails&gt;()) &#123;</span><br><span class="line">    NetworkErrorDetails network_error;</span><br><span class="line">    detail.<span class="built_in">UnpackTo</span>(&amp;network_error);</span><br><span class="line">    ... processing network_error ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><p>使用 <code>service</code> 来定义一个 RPC 服务接口</p>
<figure class="highlight pb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service SearchService &#123;</span><br><span class="line">  rpc Search(SearchRequest) returns (SearchResponse)<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="option"><a href="#option" class="headerlink" title="option"></a>option</h2><p><code>option</code> 不会改变声明的整体含义，但可能会影响在特定上下文中的处理方式</p>
<p>完成的可用 <code>option</code> 在 &#x2F;usr&#x2F;include&#x2F;google&#x2F;protobuf&#x2F;descriptor.proto</p>
<h3 id="optimize-for"><a href="#optimize-for" class="headerlink" title="optimize_for"></a>optimize_for</h3><figure class="highlight pb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">option optimize_for = CODE_SIZE<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>文件级，可选值有 <code>CODE_SIZE</code>、<code>SPEED</code> 和 <code>LITE_RUNTIME</code></p>
<ul>
<li><p><code>CODE_SIZE</code> 占空间少</p>
</li>
<li><p><code>SPEED</code> 运行效率高，但占更多空间</p>
</li>
<li><p><code>LITE_RUNTIME</code> 运行效率高，占空间少，但缺乏反射</p>
</li>
</ul>
<h2 id="protoc"><a href="#protoc" class="headerlink" title="protoc"></a>protoc</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --proto_path=IMPORT_PATH --cpp_out=DST_DIR --java_out=DST_DIR --python_out=DST_DIR --go_out=DST_DIR --ruby_out=DST_DIR --objc_out=DST_DIR --csharp_out=DST_DIR path/to/file.proto</span><br></pre></td></tr></table></figure>

<p><code>--proto_path</code> 指定搜索 .proto 的文件地址，一次只能指定一个地址，可缩写成 <code>--I</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/07/CMake-%E8%84%9A%E6%9C%AC%E5%91%BD%E4%BB%A4-find-library/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/07/CMake-%E8%84%9A%E6%9C%AC%E5%91%BD%E4%BB%A4-find-library/" class="post-title-link" itemprop="url">find_library</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-07 11:12:39" itemprop="dateCreated datePublished" datetime="2023-06-07T11:12:39+08:00">2023-06-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-11 17:03:26" itemprop="dateModified" datetime="2024-03-11T17:03:26+08:00">2024-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/cmake/" itemprop="url" rel="index"><span itemprop="name">cmake</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>find_library</code> 是一个用于在系统中搜索特定的库文件，它不依赖于库提供的 CMake 配置文件，而是直接查找库文件</p>
<p>使用 <code>find_library</code> 时，需要手动指定库文件路径、头文件路径等</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_library</span> (&lt;VAR&gt; name1 [path1 path2 ...])</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_library</span> (</span><br><span class="line">          &lt;VAR&gt;</span><br><span class="line">          name | NAMES name1 [name2 ...] [NAMES_PER_DIR]</span><br><span class="line">          [HINTS [path | ENV var]... ]</span><br><span class="line">          [PATHS [path | ENV var]... ]</span><br><span class="line">          [PATH_SUFFIXES suffix1 [suffix2 ...]]</span><br><span class="line">          [DOC <span class="string">&quot;cache documentation string&quot;</span>]</span><br><span class="line">          [NO_CACHE]</span><br><span class="line">          [REQUIRED]</span><br><span class="line">          [NO_DEFAULT_PATH]</span><br><span class="line">          [NO_PACKAGE_ROOT_PATH]</span><br><span class="line">          [NO_CMAKE_PATH]</span><br><span class="line">          [NO_CMAKE_ENVIRONMENT_PATH]</span><br><span class="line">          [NO_SYSTEM_ENVIRONMENT_PATH]</span><br><span class="line">          [NO_CMAKE_SYSTEM_PATH]</span><br><span class="line">          [CMAKE_FIND_ROOT_PATH_BOTH |</span><br><span class="line">           ONLY_CMAKE_FIND_ROOT_PATH |</span><br><span class="line">           NO_CMAKE_FIND_ROOT_PATH]</span><br><span class="line">         )</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>NAMES</code> 指定库名</p>
</li>
<li><p><code>HINTS, PATHS</code> 指定额外的搜索地址，<code>ENV var</code> 指定从环境变量读取</p>
</li>
<li><p><code>NO_CACHE</code> 将结果存储在普通变量的 <code>VAR</code> 中，而不是 cache 变量 <code>VAR</code></p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/41/">41</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chaxxro</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
