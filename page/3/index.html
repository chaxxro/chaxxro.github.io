<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"chaxxro.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="好记性不如烂键盘">
<meta property="og:type" content="website">
<meta property="og:title" content="也无风雨也无晴">
<meta property="og:url" content="https://chaxxro.github.io/page/3/index.html">
<meta property="og:site_name" content="也无风雨也无晴">
<meta property="og:description" content="好记性不如烂键盘">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="chaxxro">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://chaxxro.github.io/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>也无风雨也无晴</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">也无风雨也无晴</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">chaxxro</p>
  <div class="site-description" itemprop="description">好记性不如烂键盘</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">404</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" class="post-title-link" itemprop="url">设计原则</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-28 16:33:57" itemprop="dateCreated datePublished" datetime="2023-06-28T16:33:57+08:00">2023-06-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-01 21:52:09" itemprop="dateModified" datetime="2023-08-01T21:52:09+08:00">2023-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="开闭原则"><a href="#开闭原则" class="headerlink" title="开闭原则"></a>开闭原则</h2><p>开闭原则就是说对扩展开放，对修改关闭</p>
<p>在程序需要进行拓展的时候，不能去修改原有的代码，而是要扩展原有代码，实现一个热插拔的效果</p>
<h2 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h2><p>一个类只负责完成一个职责或者功能，不要设计大而全的类，要设计粒度小、功能单一的类</p>
<p>一个类包含了两个或者两个以上业务不相干的功能，那就是职责不够单一，应该将它拆分成多个功能更加单一、粒度更细的类。</p>
<h2 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h2><p>子类对象能够替换程序中父类对象出现的任何地方，并且保证原来程序的逻辑行为不变及正确性不被破坏</p>
<p>子类在设计的时候要遵守父类的行为约。父类定义了函数的行为约定，那子类可以改变函数的内部实现逻辑，但不能改变函数原有的行为约定。这里的行为约定包括：函数声明要实现的功能；对输入、输出、异常的约定，甚至包括注释中所罗列的任何特殊说明</p>
<h2 id="接口隔离原则"><a href="#接口隔离原则" class="headerlink" title="接口隔离原则"></a>接口隔离原则</h2><p>调用者或者使用者不应该被强迫依赖它不需要的接口</p>
<p>如果把接口理解为一组接口集合，可以是某个微服务的接口，也可以是某个类库的接口等。如果部分接口只被部分调用者使用，就需要将这部分接口隔离出来，单独给这部分调用者使用，而不强迫其他调用者也依赖这部分不会被用到的接口</p>
<p>如果把接口理解为单个 API 接口或函数，部分调用者只需要函数中的部分功能，那就需要把函数拆分成粒度更细的多个函数，让调用者只依赖它需要的那个细粒度函数</p>
<p>如果把接口理解为 OOP 中的接口，那接口的设计要尽量单一，不要让接口的实现类和调用者，依赖不需要的接口函数</p>
<p>接口隔离原则相对于单一职责原则，一方面它更侧重于接口的设计，另一方面它的思考的角度不同。它提供了一种判断接口是否职责单一的标准：通过调用者如何使用接口来间接地判定。如果调用者只使用部分接口或接口的部分功能，那接口的设计就不够职责单一</p>
<h2 id="依赖反转原则"><a href="#依赖反转原则" class="headerlink" title="依赖反转原则"></a>依赖反转原则</h2><h3 id="控制反转-IOC"><a href="#控制反转-IOC" class="headerlink" title="控制反转 IOC"></a>控制反转 IOC</h3><p>控制指的是对程序执行流程的控制，反转指的是由程序员自己控制程序的执行变成程序的执行流程通过框架来控制，流程的控制权从程序员反转到了框架</p>
<p>控制反转并不是一种具体的实现技巧，而是一个比较笼统的设计思想，一般用来指导框架层面的设计</p>
<h3 id="依赖注入-DI"><a href="#依赖注入-DI" class="headerlink" title="依赖注入 DI"></a>依赖注入 DI</h3><p>依赖注入跟控制反转恰恰相反，它是一种具体的编码技巧</p>
<p>DI 指不通过 <code>new()</code> 的方式在类内部创建依赖类对象，而是将依赖的类对象在外部创建好之后，通过构造函数、函数参数等方式传递或注入给类使用</p>
<p>通过依赖注入的方式来将依赖的类对象传递进来，这样就提高了代码的扩展性</p>
<h3 id="依赖反转-DIP"><a href="#依赖反转-DIP" class="headerlink" title="依赖反转 DIP"></a>依赖反转 DIP</h3><p>这条原则主要还是用来指导框架层面的设计</p>
<ul>
<li><p>调用者不要依赖被调用者</p>
</li>
<li><p>调用者和被调用者应该通过抽象来互相依赖</p>
</li>
<li><p>抽象不要依赖具体实现细节，具体实现细节依赖抽象</p>
</li>
</ul>
<h2 id="迪米特法则"><a href="#迪米特法则" class="headerlink" title="迪米特法则"></a>迪米特法则</h2><p>高内聚是指相近的功能应该放到同一个类中，不相近的功能不要放到同一个类中。相近的功能往往会被同时修改，放到同一个类中，修改会比较集中，代码容易维护</p>
<p>松耦合是指在代码中，类与类之间的依赖关系简单清晰。即使两个类有依赖关系，一个类的代码改动不会或者很少导致依赖类的代码改动</p>
<p>迪米特法则指不该有直接依赖关系的类之间不要有依赖，有依赖关系的类之间尽量只依赖必要的接口</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/25/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/25/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-%E6%83%8A%E7%BE%A4%E6%95%88%E5%BA%94/" class="post-title-link" itemprop="url">惊群效应</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-25 20:55:50" itemprop="dateCreated datePublished" datetime="2023-06-25T20:55:50+08:00">2023-06-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-01 21:52:09" itemprop="dateModified" datetime="2023-08-01T21:52:09+08:00">2023-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">网络编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>惊群效应就是多进程（多线程）在同时阻塞等待同一个事件的时候，如果等待的事件发生，那么就会唤醒等待的所有进程（线程），但最终却只可能有一个进程（线程）获得这个事件并对该事件进行处理，而其他进程（线程）只能重新进入休眠状态，这种现象就叫做惊群</p>
<h2 id="性能消耗"><a href="#性能消耗" class="headerlink" title="性能消耗"></a>性能消耗</h2><ul>
<li><p>系统对用户进程&#x2F;线程频繁地做无效的调度，上下文切换系统性能大打折扣</p>
</li>
<li><p>为了确保只有一个线程得到资源，用户必须对资源操作进行加锁保护，进一步加大了系统开销</p>
</li>
</ul>
<h2 id="accept-惊群"><a href="#accept-惊群" class="headerlink" title="accept 惊群"></a>accept 惊群</h2><p>主进程创建了 <code>socket()</code>、<code>bind()</code>、<code>listen()</code> 之后，<code>fork()</code> 出来多个进程，每个子进程都开始处理 <code>accept()</code>，这些进程都会阻塞在同一个 <code>accept()</code> 上</p>
<p>当来了新的连接时，所有阻塞在 <code>accept</code> 上的的进程都会被唤醒，但是只有一个进程会接受成功，其余都会失败重新休眠</p>
<p>linux 内核通过睡眠队列来组织所有等待某个事件的 task，而 wakeup 机制可以异步唤醒整个睡眠队列上的 task，wakeup 逻辑在唤醒睡眠队列时，会遍历该队列链表上的每一个节点，调用每一个节点的 <code>callback</code>，从而唤醒睡眠队列上的每个 task，造成惊群现象</p>
<p>内核通过添加一个 <code>WQ_FLAG_EXCLUSIVE</code> 标记解决了 <code>accept</code> 惊群，该标记告诉内核进行排他性的唤醒，唤醒一个进程后即退出唤醒的过程</p>
<h2 id="epoll-惊群"><a href="#epoll-惊群" class="headerlink" title="epoll 惊群"></a>epoll 惊群</h2><p>主进程创建 <code>socket()</code>、<code>bind</code>、<code>listen()</code> 后将该 socket 加入到 <code>epoll()</code> 中，然后 <code>fork()</code> 出多个子进程，每个进程共享一颗红黑树，都阻塞在 <code>epoll_wait()</code> 上</p>
<p>当 <code>accept</code> 事件进来时所有进程都会被唤醒，然后只有一个进程能 <code>accept()</code> 成功，造成惊群现象</p>
<h3 id="NGINX-解决方案"><a href="#NGINX-解决方案" class="headerlink" title="NGINX 解决方案"></a>NGINX 解决方案</h3><p>每个 worker 进程在监听 fd 事件之前先要通过 <code>ngx_trylock_accept_mutex</code> 去获取一个全局的锁</p>
<ul>
<li><p>如果获得锁成功，那么开始处理事件</p>
</li>
<li><p>如果获得锁失败，则放弃本次操作</p>
</li>
</ul>
<p>所以从某种意义上来讲，对于某一个 fd，Nginx 同时只有一个 worker 来处理 fd 上的事件，从而避免惊群</p>
<p>在用户空间实现进程间锁，需要有一个让所有进程共享的东西，比如 <code>mmap</code> 内存、文件等，然后通过这个东西来控制进程的互斥</p>
<h3 id="LT、ET-下的惊群"><a href="#LT、ET-下的惊群" class="headerlink" title="LT、ET 下的惊群"></a>LT、ET 下的惊群</h3><p>LT 模式下会唤醒睡眠队列上所有进程，ET 模式下仅会唤醒一个进程，所以 ET 模式没有惊群</p>
<h4 id="先-epoll-create-后-fork"><a href="#先-epoll-create-后-fork" class="headerlink" title="先 epoll_create 后 fork"></a>先 epoll_create 后 fork</h4><p>多个进程公用一个内核 <code>epoll</code> 对象，从而对 <code>epoll</code> 对象的操作会相互影响</p>
<p>LT 模式下没法避免惊群，但 LT 是链式唤醒，唤醒过程中直到没有事件被处理时会终止唤醒</p>
<h3 id="先-fork-后-epoll-create"><a href="#先-fork-后-epoll-create" class="headerlink" title="先 fork 后 epoll_create"></a>先 fork 后 epoll_create</h3><p>父进程创建了 listen fd 后 <code>fork</code> 多个 worker 子进程来共同处理请求，这个时候多个子进程分别创建自己独立的 <code>epoll</code> fd，然后将同一个 listen fd 加入到 <code>epoll</code> 中，监听其可读事件</p>
<p>不管 listen fd 是以 LT 还是 ET 模式加入到 <code>epoll</code>，多个进程之间的 <code>epoll</code> 是平等的，于是 listen fd 上的一个请求会唤醒所有的进程</p>
<p>Linux 新内核中增加了 <code>EPOLLEXCLUSIVE</code>，该选项通过 <code>EPOLL_CTL_ADD</code> 对需要监控的fd 设置 <code>EPOLLEXCLUSIVE</code> 标记，从而在遍历并唤醒等待队列上的进程时，遇到并唤醒第一个带 <code>WQ_FLAG_EXCLUSIVE</code> 标记进程后，就结束遍历唤醒过程，从而解决多进程独立 <code>epoll</code> 的惊群问题</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/20/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE-ssl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/20/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE-ssl/" class="post-title-link" itemprop="url">ssl</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-20 21:34:36" itemprop="dateCreated datePublished" datetime="2023-06-20T21:34:36+08:00">2023-06-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-01 21:52:09" itemprop="dateModified" datetime="2023-08-01T21:52:09+08:00">2023-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" itemprop="url" rel="index"><span itemprop="name">网络协议</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>SSL 即安全套接层（Secure Sockets Layer），在 OSI 模型中处于会话层</p>
<p>在 1999 年它改名为 TLS（Transport Layer Security），目前应用的最广泛的 TLS 是 1.2，而之前的协议（TLS1.1&#x2F;1.0、SSLv3&#x2F;v2）都已经被认为是不安全的</p>
<h2 id="数据机密性"><a href="#数据机密性" class="headerlink" title="数据机密性"></a>数据机密性</h2><p>SSL&#x2F;TLS 通过加密（encrypt）得到密文（cipher text），从而保证数据传输的安全性</p>
<p>只有拥有密钥的人才能够通过解密（decrypt）获得明文（plain text），加密解密的操作过程就是加密算法</p>
<p>密钥是一长串的数字，约定俗成的度量单位是位。密钥长度是 128 就是 16 字节的二进制串，密钥长度 1024 就是 128 字节的二进制串</p>
<p>按照密钥的使用方式，加密可以分为两大类：对称加密和非对称加密</p>
<h3 id="对称秘钥加密"><a href="#对称秘钥加密" class="headerlink" title="对称秘钥加密"></a>对称秘钥加密</h3><p>加密和解密使用同一密钥，TLS 里目前常用的有 AES 和 ChaCha20</p>
<ul>
<li><p>优点：运算速度快</p>
</li>
<li><p>缺点：无法安全地将密钥传输给通信方</p>
</li>
</ul>
<h3 id="非对称秘钥加密"><a href="#非对称秘钥加密" class="headerlink" title="非对称秘钥加密"></a>非对称秘钥加密</h3><p>加密和解密使用不同的密钥，公开密钥所有人都可以获得</p>
<p>公钥和私钥中的任一个均可用作加密，此时另一个则用作解密</p>
<p>在 TLS 里常用的有 DH、DSA、RSA、ECC 等</p>
<ul>
<li><p>优点：可以更安全地将公开密钥传输给通信发送方</p>
</li>
<li><p>缺点：运算速度慢</p>
</li>
</ul>
<h3 id="混合加密"><a href="#混合加密" class="headerlink" title="混合加密"></a>混合加密</h3><p>非对称加密运算速度太慢，所以 TLS 使用混合加密，既能高效加解密，又能安全传输数据</p>
<ol>
<li><p>客户端用随机数生成对称算法使用的会话密钥（session key）</p>
</li>
<li><p>客户端用非对成算法的公钥将会话密钥加密，然后发送至服务端</p>
</li>
<li><p>服务端拿到密文后用私钥解密，取出会话密钥</p>
</li>
<li><p>双方实现了对称密钥的安全交换，后续就不再使用非对称加密，全都使用对称加密</p>
</li>
</ol>
<h2 id="数据完整性"><a href="#数据完整性" class="headerlink" title="数据完整性"></a>数据完整性</h2><p>实现完整性的手段主要是摘要算法</p>
<p>把摘要算法可以近似地理解成一种特殊的加密算法，它能够把任意长度的数据加密成固定长度、而且独一无二的摘要字符串，且不能从压缩后的密文中推导出原文</p>
<p>MD5、SHA-1 是最常用的两个摘要算法，能够生成 16 字节和 20 字节长度的数字摘要，但这两个算法的安全强度比较低，在 TLS 里已经被禁止使用了</p>
<p>摘要算法保证了数字摘要和原文是完全等价的，所以只要在原文后附上它的摘要，就能够保证数据的完整性</p>
<p>摘要算法不具有机密性，所以真正的完整性还是需要建立在机密性之上</p>
<h2 id="身份认证"><a href="#身份认证" class="headerlink" title="身份认证"></a>身份认证</h2><h3 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h3><p>数字签名就是用私钥加密原文的摘要</p>
<h3 id="数字证书和-CA"><a href="#数字证书和-CA" class="headerlink" title="数字证书和 CA"></a>数字证书和 CA</h3><p>因为公钥是任何人都可以发布的，所以需要引入第三方来保证公钥的可信度，这个第三方就是常说的 CA（Certificate Authority，证书认证机构）</p>
<p>CA 对公钥的签名认证也是有格式的，要包含公钥的序列号、用途、颁发者、有效时间等，把这些打成一个包再签名，完整地证明公钥关联的各种信息，形成数字证书（Certificate）</p>
<p>小一点的 CA 可以让大 CA 签名认证，但链条的最后 Root CA，就只能自己证明自己了，这个就叫自签名证书（Self-Signed Certificate）或者根证书（Root Certificate）</p>
<ol>
<li><p>服务器把自己的公钥等信息发布在数字证书认证机构</p>
</li>
<li><p>数字证书认证机构用自己的私钥给服务器的公钥颁发数字证书</p>
</li>
<li><p>浏览器内置一个受信任的 CA 机构列表</p>
</li>
<li><p>浏览器访问服务器时，服务器会提供经 CA 机构认证颁发的数字证书，如果认证该数字证书的 CA 机构存在于浏览器的受信任 CA 机构列表中，并且数字证书中的信息与当前正在访问的网站一致，那么浏览器就认为服务端是可信的，并从数字证书中取得服务器公钥</p>
</li>
</ol>
<h2 id="SSL-连接"><a href="#SSL-连接" class="headerlink" title="SSL 连接"></a>SSL 连接</h2><img src="/2023/06/20/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE-ssl/01.png" class="">

<ol>
<li><p>ClientHello：由客户端向服务器发起加密通信请求，主要向服务器发送信息包括：客户端支持的 SSL&#x2F;TLS 协议版本；客户端生产的随机数（Client Random），后面用于生产对称加密的密钥；客户端支持的密码套件列表，如 RSA 加密算法</p>
</li>
<li><p>ServerHello：服务器收到客户端请求后，向客户端发出响应，回应的内容包括：确认 SSL&#x2F; TLS 协议版本，如果浏览器不支持，则关闭加密通信；服务器生产的随机数（Server Random），后面用于生产对称加密的密钥；确认的密码套件列表，如 RSA 加密算法</p>
</li>
<li><p>Server Certificate：服务器发送数字证书</p>
</li>
<li><p>客户端验证签名和证书：客户端收到服务器的证书后，通过浏览器或者操作系统中的 CA 公钥，确认服务器的数字证书的真实性</p>
</li>
<li><p>客户端计算 pre-master key：如果证书没有问题，客户端会从数字证书中取出服务器的公钥，并使用它加密报文，向服务器发送以下信息：</p>
</li>
</ol>
<ul>
<li><p>一个随机数（pre-master key），并使用公钥进行非对称加密</p>
</li>
<li><p>加密通信算法改变通知，表示之后的信息都将用对称加密的密钥加密通信</p>
</li>
<li><p>客户端握手结束通知，表示客户端的握手阶段已经结束</p>
</li>
</ul>
<ol start="4">
<li>服务端计算对称加密密钥：服务器收到客户端的第三个随机数（pre-master key）之后，通过协商的加密算法，计算出本次通信的对称加密秘钥，向客户端发生最后的信息：</li>
</ol>
<ul>
<li><p>加密通信算法改变通知，表示随后的信息都将用对称加密秘钥加密通信</p>
</li>
<li><p>服务器握手结束通知，表示服务器的握手阶段已经结束</p>
</li>
</ul>
<p>握手阶段全部结束后，客户端与服务器进入加密通信，就完全是使用普通的 HTTP 协议，只不过用会话密钥加密内容</p>
<p>客户端和服务器端都拥有三个随机数，双方使用事先商定的加密方法各自生成本次会话所用的同一把对称会话密钥</p>
<h3 id="为什么需要随机数"><a href="#为什么需要随机数" class="headerlink" title="为什么需要随机数"></a>为什么需要随机数</h3><ul>
<li><p>SSL 协议中证书是静态的，因此有必要引入一种随机因素来保证协商出来的会话密钥的随机性</p>
</li>
<li><p>SSL&#x2F;TLS 握手过程的数据都是明文传输的，并且多个随机数种子来生成秘钥不容易被暴力破解出来</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/19/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-CountMinSketch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/19/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-CountMinSketch/" class="post-title-link" itemprop="url">CoundMinSketch</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-19 21:32:36" itemprop="dateCreated datePublished" datetime="2023-06-19T21:32:36+08:00">2023-06-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-01 21:52:09" itemprop="dateModified" datetime="2023-08-01T21:52:09+08:00">2023-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>当需要在一定准确性情况下统计元素的个数，可以使用 CountMinSketch 数据结构</p>
<p>CountMinSketch 通过牺牲部分准确性来支持固定空间</p>
<p>CountMinSketch 有 d 个哈希函数和 d 个长度为 n 的数组，其工作流程：</p>
<ol>
<li><p>每个哈希函数对应一个数组，数组的初始值都是 0</p>
</li>
<li><p>插入元素时，计算元素的 d 个对应哈希值，并将相对应数组中的值加 1</p>
</li>
<li><p>元素次数是各个数组中相对应位置的最小值</p>
</li>
</ol>
<p>应用场景：大数据量且对计数的准确性要求不高</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/19/Linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-perf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/19/Linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-perf/" class="post-title-link" itemprop="url">perf</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-19 11:16:41" itemprop="dateCreated datePublished" datetime="2023-06-19T11:16:41+08:00">2023-06-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-01 21:52:08" itemprop="dateModified" datetime="2023-08-01T21:52:08+08:00">2023-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux-%E5%91%BD%E4%BB%A4%E8%A1%8C/" itemprop="url" rel="index"><span itemprop="name">Linux 命令行</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>perf 是 performance 的缩写，是一个事件驱动的可观测性工具</p>
<h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><p><code>perf list</code> 查看支持事件，一般来说分为六类</p>
<ul>
<li><p>硬件事件，来自于 CPU 硬件监控计数器</p>
</li>
<li><p>软件事件，来自于内核计数器</p>
</li>
<li><p>内核追踪点事件，来自于内核中硬编码的静态指令点</p>
</li>
<li><p>USDT 事件，来自于用户程序的静态追踪点</p>
</li>
<li><p>动态追踪事件，来自于软件动态插桩</p>
</li>
<li><p>时许剖析，来自于通过 <code>perf record</code> 收集到的数据</p>
</li>
</ul>
<h3 id="软件事件"><a href="#软件事件" class="headerlink" title="软件事件"></a>软件事件</h3><ul>
<li><p>cpu-clock，cpu 执行的计数器</p>
</li>
<li><p>task-clock，某个任务在 cpu 上运行时的 clock 数</p>
</li>
<li><p>page-faults，缺页中断数</p>
</li>
<li><p>alignment-faults，对齐错误</p>
</li>
<li><p>context-switches，上下文切换数</p>
</li>
<li><p>cpu-migrations，任务在 cpu 间迁移数</p>
</li>
<li><p>minor-faults，缺页中断一部分，指的是访问在内存中但是没有映射到程序地址空间的页发生的错误</p>
</li>
<li><p>major-faults，缺页中断一部分，指的是访问不在内存中的页，需要磁盘参与进行换页的中断</p>
</li>
</ul>
<h3 id="硬件事件"><a href="#硬件事件" class="headerlink" title="硬件事件"></a>硬件事件</h3><ul>
<li><p>cache-misses，缓存不命中</p>
</li>
<li><p>branch-misses，分支预测失败</p>
</li>
<li><p>cpu-cycles，cpu 时钟情况</p>
</li>
<li><p>stalled_cycles_frontend，cpu 前端的停滞周期数</p>
</li>
<li><p>stalled_cycles_backend，cpu 后端的停滞周期数</p>
</li>
</ul>
<h2 id="计数"><a href="#计数" class="headerlink" title="计数"></a>计数</h2><p><code>perf stat</code> 来收集一些计数信息</p>
<h2 id="采样剖析"><a href="#采样剖析" class="headerlink" title="采样剖析"></a>采样剖析</h2><p><code>perf record</code> 和 <code>perf top</code> 对系统进行剖析</p>
<p>执行 <code>perf top</code> 可以看到目前的 CPU 执行占比情况，该情况会随着时间刷新，这可以帮助快速的发现热点</p>
<p><code>perf record</code> 则像是把多个时间的 <code>perf top</code> 结果作为切片保存到一个文件里，从而得到一段时间里的执行情况</p>
<p><code>perf record</code> 得到的结果数据是无法直接读取的，可以用 <code>perf script</code> 将其转换成可读文件，或者直接用 <code>perf report</code> 进行图形化展示</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/14/Bazel-WorkspaceRule/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/14/Bazel-WorkspaceRule/" class="post-title-link" itemprop="url">WorkspaceRule</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-14 14:39:09" itemprop="dateCreated datePublished" datetime="2023-06-14T14:39:09+08:00">2023-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-01 21:52:08" itemprop="dateModified" datetime="2023-08-01T21:52:08+08:00">2023-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Bazel/" itemprop="url" rel="index"><span itemprop="name">Bazel</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>WORKSPACE 文件中的 rule 主要是为了引入外部依赖，其主要分为原生 rule 和 Starlark rule</p>
<h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><p>原生 rule</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind(name, actual, compatible_with, deprecation, distribs, features, licenses, restricted_to, tags, testonly, visibility)</span><br></pre></td></tr></table></figure>

<p><code>bind</code> 用于给 target 在 <code>//external</code> 包中创建一个别名</p>
<p><code>//external</code> 不是常规的包，可以把它看成一个包含所有绑定目标的虚拟包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">bind(</span><br><span class="line">    name = &quot;javacc-latest&quot;,</span><br><span class="line">    actual = &quot;//third_party/javacc-v2&quot;,</span><br><span class="line">)</span><br><span class="line"># 使用 bind 后可以用 //external:javacc-latest 来替代 //third_party/javacc-v2</span><br><span class="line"></span><br><span class="line"># 引入外部包</span><br><span class="line">bind(</span><br><span class="line">    name = &quot;openssl&quot;,</span><br><span class="line">    actual = &quot;@my-ssl//src:openssl-lib&quot;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>bind</code> 是不推荐使用的</p>
<h2 id="local-repository"><a href="#local-repository" class="headerlink" title="local_repository"></a>local_repository</h2><p>原生 rule</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">local_repository(name, path, repo_mapping)</span><br></pre></td></tr></table></figure>

<p>引入一个本地目录中的 Bazel 仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">local_repository(</span><br><span class="line">    name = &quot;my-ssl&quot;,</span><br><span class="line">    path = &quot;/home/user/ssl&quot;,</span><br><span class="line">)</span><br><span class="line"># 之后使用 /home/user/ssl 中的 target 时可以用 @my-ssl//src:openssl-lib 表示</span><br></pre></td></tr></table></figure>

<h2 id="new-local-repository"><a href="#new-local-repository" class="headerlink" title="new_local_repository"></a>new_local_repository</h2><p>原生 rule</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new_local_repository(name, build_file, build_file_content, path, repo_mapping, workspace_file, workspace_file_content)</span><br></pre></td></tr></table></figure>

<p>引入一个本地目录中的非 Bazel 仓库或文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># WORKSPACE</span><br><span class="line">new_local_repository(</span><br><span class="line">    name = &quot;my-ssl&quot;,</span><br><span class="line">    path = &quot;/home/user/ssl&quot;,</span><br><span class="line">    build_file = &quot;BUILD.my-ssl&quot;,</span><br><span class="line">)</span><br><span class="line"># BUILD.my-ssl</span><br><span class="line">java_library(</span><br><span class="line">    name = &quot;openssl&quot;,</span><br><span class="line">    srcs = glob([&#x27;*.java&#x27;])</span><br><span class="line">    visibility = [&quot;//visibility:public&quot;],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># WORKSPACE</span><br><span class="line">new_local_repository(</span><br><span class="line">    name = &quot;piano&quot;,</span><br><span class="line">    path = &quot;/home/username/Downloads/piano.jar&quot;,</span><br><span class="line">    build_file = &quot;BUILD.piano&quot;,</span><br><span class="line">)</span><br><span class="line"># BUILD.plano</span><br><span class="line">java_import(</span><br><span class="line">    name = &quot;play-music&quot;,</span><br><span class="line">    jars = [&quot;piano.jar&quot;],</span><br><span class="line">    visibility = [&quot;//visibility:public&quot;],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="git-repository"><a href="#git-repository" class="headerlink" title="git_repository"></a>git_repository</h2><p>Starlark rule，需要 <code>load(@bazel_tools//tools/build_defs/repo:git.bzl)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git_repository(name, branch, commit, init_submodules, patch_args, patch_cmds, patch_cmds_win,</span><br><span class="line">               patch_tool, patches, recursive_init_submodules, remote, shallow_since, strip_prefix,</span><br><span class="line">               tag, verbose)</span><br></pre></td></tr></table></figure>

<p>克隆一个外部 Bazel 仓库</p>
<h2 id="new-git-repository"><a href="#new-git-repository" class="headerlink" title="new_git_repository"></a>new_git_repository</h2><p>Starlark rule，需要 <code>load(@bazel_tools//tools/build_defs/repo:git.bzl)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">new_git_repository(name, branch, build_file, build_file_content, commit, init_submodules,</span><br><span class="line">                   patch_args, patch_cmds, patch_cmds_win, patch_tool, patches,</span><br><span class="line">                   recursive_init_submodules, remote, shallow_since, strip_prefix, tag, verbose,</span><br><span class="line">                   workspace_file, workspace_file_content)</span><br></pre></td></tr></table></figure>

<p>克隆一个外部非 Bazel 仓库</p>
<h2 id="http-archive"><a href="#http-archive" class="headerlink" title="http_archive"></a>http_archive</h2><p>Starlark rule，需要 <code>load(@bazel_tools//tools/build_defs/repo:http.bzl)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http_archive(name, auth_patterns, build_file, build_file_content, canonical_id, netrc, patch_args,</span><br><span class="line">             patch_cmds, patch_cmds_win, patch_tool, patches, sha256, strip_prefix, type, url, urls,</span><br><span class="line">             workspace_file, workspace_file_content)</span><br></pre></td></tr></table></figure>

<p>下载一个压缩的 Bazel 仓库，对其解压后引入该仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># WORKSPACE</span><br><span class="line">load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)</span><br><span class="line">http_archive(</span><br><span class="line">    name = &quot;my_ssl&quot;,</span><br><span class="line">    urls = [&quot;http://example.com/openssl.zip&quot;],</span><br><span class="line">    sha256 = &quot;e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855&quot;,</span><br><span class="line">    build_file = &quot;@//:openssl.BUILD&quot;,</span><br><span class="line">)</span><br><span class="line">#openssl.BUILD</span><br><span class="line">cc_library(</span><br><span class="line">    name = &quot;openssl-lib&quot;,</span><br><span class="line">    srcs = [&quot;src/openssl.cc&quot;],</span><br><span class="line">    hdrs = [&quot;src/openssl.h&quot;],</span><br><span class="line">)</span><br><span class="line"># 使用 @my_ssl//:openssl-lib</span><br></pre></td></tr></table></figure>

<h2 id="http-file"><a href="#http-file" class="headerlink" title="http_file"></a>http_file</h2><p>Starlark rule，需要 <code>load(@bazel_tools//tools/build_defs/repo:http.bzl)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_file(name, auth_patterns, canonical_id, downloaded_file_path, executable, netrc, sha256, urls)</span><br></pre></td></tr></table></figure>

<p>通过 URL 下载文件并引入仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># WORKSPACE</span><br><span class="line">load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_file&quot;)</span><br><span class="line"></span><br><span class="line">http_file(</span><br><span class="line">    name = &quot;my_deb&quot;,</span><br><span class="line">    urls = [&quot;http://example.com/package.deb&quot;],</span><br><span class="line">    sha256 = &quot;e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855&quot;,</span><br><span class="line">)</span><br><span class="line"># 使用 @my_deb//file</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/12/Bazel-%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/12/Bazel-%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5/" class="post-title-link" itemprop="url">几个重要概念</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-12 20:12:32" itemprop="dateCreated datePublished" datetime="2023-06-12T20:12:32+08:00">2023-06-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-01 21:52:08" itemprop="dateModified" datetime="2023-08-01T21:52:08+08:00">2023-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Bazel/" itemprop="url" rel="index"><span itemprop="name">Bazel</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="工作区"><a href="#工作区" class="headerlink" title="工作区"></a>工作区</h2><p>工作区包括项目源文件、Bazel 构建产物和 Bazel 需要的文件</p>
<p>{ % asset_img 01.png % }</p>
<p>Bazel 所需文件包括：</p>
<ul>
<li><p>WORKSPACE 文件，位于项目目录结构的根目录</p>
</li>
<li><p>一个或多个 BUILD 文件，工作区中包含 BUILD 文件的目录被视为是一个包，BUILD 文件表示如何构建这个包</p>
</li>
</ul>
<p>当 Bazel 构建项目时，所有输入和依赖项必须在同一个工作区中</p>
<p>位于不同工作区中的文件彼此独立，除非链接进本工作区</p>
<h2 id="WORKSPACE-文件"><a href="#WORKSPACE-文件" class="headerlink" title="WORKSPACE 文件"></a>WORKSPACE 文件</h2><p>WORKSPACE 文件标明当前目录是项目的根目录，Bazel 会忽略子目录中的 WORKSPACE 文件，因为其他 WORKSPACE 文件会当视为其他项目的根目录</p>
<p>WORKSPACE 主要用于声明构建所需的外部依赖</p>
<p>Bazel 也支持将 WORKSPACE 文件命名为 WORKSPACE.bazel，如果两种命名同时存在时，Bazel 会使用 WORKSPACE.bazel，以为它优先级更高</p>
<p>项目根目录可以使用 <code>@</code> 替代</p>
<h2 id="包"><a href="#包" class="headerlink" title="包"></a>包</h2><p>包是 BUILD 文件或 BUILD.bazel 文件所在的目录，它包括目录中的所有文件</p>
<h2 id="BUILD-文件"><a href="#BUILD-文件" class="headerlink" title="BUILD 文件"></a>BUILD 文件</h2><p>一个 BUILD 文件包含几种不同类型的 Bazel 指令，最重要的指令是构建规则，它告诉 Bazel 如何构建所需的输出</p>
<p>BUILD 文件中构建规则作用于 target，该 target 对应一组特定的源文件和依赖项</p>
<p>一个 target 还可以依赖其他 target</p>
<p>一个 target 的默认可见性是当前 BUILD 文件，即当前目录包中，但可以显式地指定 target 的可见性</p>
<p>BUILD 文件使用 Starlark 语言编写，但不允许有函数的定义、<code>for</code> 语句、<code>if</code> 语句，可以有列表推导和 <code>if</code> 表达式，函数应该被定义在 .bzzl 文件中，而且 <code>*args</code> 和 <code> **kwargs</code> 不允许使用，除非显示列出所有参数</p>
<h2 id="target-名称"><a href="#target-名称" class="headerlink" title="target 名称"></a>target 名称</h2><p>在 BUILD 文件和命令行中，target 名称格式是 <code>@myrepo//path_to_package:target_name</code></p>
<ul>
<li><p>如果引用的 target 跟当前 target 在同一工作区，可以使用 <code>//path_to_package:target_name</code></p>
</li>
<li><p>如果引用的 target 在当前 BUILD 目录中，可以直接使用 <code>:target_name</code></p>
</li>
<li><p>如果引用的 target 在 WORKSPACE 目录中，可以直接使用 <code>//:target_name</code></p>
</li>
</ul>
<h2 id="加载扩展"><a href="#加载扩展" class="headerlink" title="加载扩展"></a>加载扩展</h2><p>扩展需要写在 .bzl 文件中，通过 <code>load</code> 引入</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/08/CMake-%E5%B7%A5%E7%A8%8B%E5%91%BD%E4%BB%A4-link-directories/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/08/CMake-%E5%B7%A5%E7%A8%8B%E5%91%BD%E4%BB%A4-link-directories/" class="post-title-link" itemprop="url">link_directories</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-08 21:22:05" itemprop="dateCreated datePublished" datetime="2023-06-08T21:22:05+08:00">2023-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-01 21:52:08" itemprop="dateModified" datetime="2023-08-01T21:52:08+08:00">2023-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/cmake/" itemprop="url" rel="index"><span itemprop="name">cmake</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">link_directories</span>([AFTER|BEFORE] [SYSTEM] dir1 [dir2 ...])</span><br></pre></td></tr></table></figure>

<p>将 dir 放入搜索库文件地址列表 <code>LINK_DIRECTORIES</code> 中，插入位置默认是末尾 <code>AFTER</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/08/CMake-%E5%B7%A5%E7%A8%8B%E5%91%BD%E4%BB%A4-include-directories/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/08/CMake-%E5%B7%A5%E7%A8%8B%E5%91%BD%E4%BB%A4-include-directories/" class="post-title-link" itemprop="url">include_direcotries</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-08 21:21:55" itemprop="dateCreated datePublished" datetime="2023-06-08T21:21:55+08:00">2023-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-01 21:52:08" itemprop="dateModified" datetime="2023-08-01T21:52:08+08:00">2023-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/cmake/" itemprop="url" rel="index"><span itemprop="name">cmake</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_directories</span>([AFTER|BEFORE] [SYSTEM] dir1 [dir2 ...])</span><br></pre></td></tr></table></figure>

<p>将 dir 放入搜索头文件地址列表 <code>INCLUDE_DIRECTORIES</code> 中，插入位置默认是末尾 <code>AFTER</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chaxxro.github.io/2023/06/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-Proactor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaxxro">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="也无风雨也无晴">
      <meta itemprop="description" content="好记性不如烂键盘">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 也无风雨也无晴">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-Proactor/" class="post-title-link" itemprop="url">Proactor</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-08 20:40:36" itemprop="dateCreated datePublished" datetime="2023-06-08T20:40:36+08:00">2023-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-08-01 21:52:09" itemprop="dateModified" datetime="2023-08-01T21:52:09+08:00">2023-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">网络编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Proactor 采用了异步 IO 技术，所以被称为异步网络模型</p>
<ul>
<li><p>Reactor 是非阻塞同步网络模式，感知的是就绪可读写事件</p>
</li>
<li><p>Proactor 是异步网络模式， 感知的是已完成的读写事件</p>
</li>
</ul>
<p>无论是 Reactor 还是 Proactor，都是一种基于事件分发的网络编程模式，区别在于 Reactor 模式是基于待完成的 IO 事件，而 Proactor 模式则是基于已完成的 IO 事件</p>
<img src="/2023/06/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-Proactor/01.png" class="">

<p>Proactor 性能高于 Reactor，但依赖操作系统对异步 IO 的支持</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/41/">41</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chaxxro</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
