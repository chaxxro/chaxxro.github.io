---
toc:
  enable: true
  number: false
  max_depth: 3
title: 进程的内存结构
date: 2023-04-28 20:51:47
tags: 操作系统
categories: 进程
---

每个进程所分配的内存由很多部分组成，通常称之为段

{% asset_img 01.png %}

## 文本段 （text 段）

- 包含了进程运行的程序机器语言指令

- 文本段具有只读属性，以防止进程通过错误指针意外修改自身指令

- 因为多个进程可同时运行同一程序，所以又将文本段设为可共享，一份程序代码的拷贝可以映射到所有这些进程的虚拟地址空间中

## 初始化的数据段（data 段）

- 包含显式初始化的全局变量和静态变量

- 当程序加载到内存时，从可执行文件中读取这些变量的值

## 未初始化数据段（BSS 段）

- 包含了未进行显式初始化的全局变量和静态变量

- 程序启动之前，系统将本段内所有内存初始化为 0

- 程序结束后静态变量资源由系统自动释放

将经始化的全局变量和静态变量与未初始化的全局变量和静态变量分开存放，其主要原因在于程序在磁盘上存储时，没有必要为未经初始化的变量分配存储空间。可执行文件只需记录未初始化数据段的位置及所需大小，直到运行时再由程序加载器来分配空间

## 堆

- 可在运行时为变量动态进行内存分配的一块区域

- 从低地址位向高地址位增长，采用链式存储结构

## 栈

- 一个动态增长和收缩的段，由栈帧组成

- 从高地址位向低地址位增长的，是一块连续的内存区域，最大容量是由系统预先定义好的，用户能从栈中获取的空间较小

- 系统会为每个当前调用的函数分配一个栈帧

## 内核空间

在 32 位 Linux 系统中，内核空间的大小通常是 1GB。这意味着整个 4GB 的虚拟地址空间中，1GB 被保留给内核空间，而 3GB 用于用户空间

在 64 位 Linux 系统中，内核空间的大小更大，通常是 128TB

需要注意的是，具体的内核空间大小可能会因 Linux 发行版、内核版本、配置以及硬件架构的不同而有所变化

## 包含 static、virtual 的类内存分布

- `static` 修饰成员变量在 data 段

- `static` 修饰的成员函数在 text 端

- 虚指针和该类其他成员一起存储在 data 段，其值指向 data 段中的类虚函数表，虚函数表中存放着一个个函数指针，函数指针指向 text 段中的具体函数

{% asset_img 02.png %}