---
toc:
  enable: true
  number: false
  max_depth: 3
title: 内存管理
date: 2023-08-09 14:47:58
tags: 操作系统
categories: 内存管理
---

Linux 的内存管理系统自底向上大致可以被划分为内核层内存管理、用户层内存管理和应用程序内存管理

## 内核层内存管理

`kmalloc()`、`__get_free_pages()` 用于申请较小内存，申请的内存位于物理内存的映射区域，而且在物理上也是连续的，它们与真实的物理地址只有一个固定的偏移

- `kmalloc()` 以字节为单位

- `__get_free_pages()` 以页为单位

`vmalloc()` 用于申请较大内存，虚拟内存空间给出一块连续的内存区，但不保证物理内存连续，开销远大于 `__get_free_pages()`，需要建立新的页表

## 用户层内存管理

操作系统提供系统调用 `brk()`、`mmap()` 实现进程的内存分配

- `brk` 用于申请和释放小内存。将数据段的最高地址指针 _edata 向高或低移动实现堆内存的扩张或收缩，低地址堆内存必须在高地址堆内存的释放之后才能得到的释放

- `mmap` 用于申请大内存。在堆和栈之间的文件映射区分配空间，分配的内存可以单独释放