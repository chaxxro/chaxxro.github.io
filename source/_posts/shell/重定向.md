---
toc:
  enable: true
  number: false
  max_depth: 3
title: 重定向
date: 2023-03-28 19:48:06
tags: shell
categories: shell
---

## 基础重定向

- 0 表示标准输入 STDIN

- 1 表示标准输出 STDOUT

- 2 标准标准错误输出 STDERR

`>` 输出重定向，默认文件描述符是 1

`<` 输入重定向，默认文件描述符是 0

```sh
# 将输出重定向到 file
command > file   
# 将输入重定向到 file
command < file  
# 将输出以追加的方式重定向到 file
command >> file

# 只看报错信息
find /etc -name passwd > /dev/null
# 只看正确输出信息
find /etc -name passwd 2> /dev/null
```

## 改变 shell 输入输出环境变量

一般重定向都是放到命令后面作为后缀使用，所以如果单纯改变描述符，需要在前面加 `exec` 命令

```sh
exec > /tmp/out.log
exec < /tmp/in.log
```

由于 bash 下运行的命令都是 bash 的子进程，会继承 bash 进程的环境变量，所以经过上面的设置后，其它命令的标准输入输出默认也会重定向到指定文件

## 新建文件述符

```sh
# 新建一个用来输入的描述符
exec n<file
# 新建一个用来输出的描述符
exec n>file
# 新建一个用来输入和输出的描述符
exec n<>file
```

- n 建议在 [3, 9]

- file 都应该写一个文件路径，用来表示这个文件描述符的关联文件是谁

- 只要不手动关闭文件，或当前 shell 进程不退出，file 将一直处于打开状态

## 复制文件描述符

```sh
# 复制输入文件描述符
n<&fd
# 将 fd 复制给输入文件描述符 n，之后从 n 读取的数据都会改为从 fd 读取

# 复制输出文件描述符
n>&fd
# 将 fd 复制给输出文件描述符 n，之后输出给 n 的数据都会改为输出给 fd

# 将标准报错输出重定向到标准输出
find /etc -name passwd 2>&1
# 什么信息都不看
find /etc -name passwd > /dev/null 2>&1
```

复制文件描述符复制的是底层关联的文件，所以当指定 `3>&1` 后，3 和 1 共用 STDOUT，如果后续执行 `1>&4`，3 仍是 STDOUT

## 关闭文件描述符

将 `-` 复制重定位给文件描述符，表示关闭这个文件描述符

```sh
exec 3>&-
exec 3<&-
```

## 移动文件描述符

将原有描述符在新的描述符编号上打开，并且关闭原有描述符

```sh
# 移动输入描述符
n<&fd-
# 移动输出描述符
n>&fd-
```

## 重定向顺序

`>file 2>&1` 表示两个过程：

1. 将 1 重定向到 file

2. 将 1 复制给 2，因为 1 已经重定向到 file，所以 2 也重定向到 file

`2>&1 >file` 表示两个过程：

1. 将 1 复制给 2，所以 2 重定向到 STDOUT

2. 将 1 重定向到 file