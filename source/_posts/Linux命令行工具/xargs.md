---
toc:
  enable: true
  number: false
  max_depth: 3
title: xargs
date: 2023-04-25 10:29:29
tags: 命令行工具
categories: Linux 命令行
---

管道实现的是将前面的 stdout 作为后面的 stdin，但是有些命令不接受管道的传递方式，最常见的就是 `ls` 命令

有些时候命令希望管道传递的是参数，但是直接用管道有时无法传递到命令的参数位，这时候需要 `xargs`

`xargs` 实现的是将管道传输过来的 stdin 进行处理然后传递到命令的参数位上

还可以将 stdin 或者文件 stdin 分割成批，每个批中有很多分割片段，然后将这些片段按批交给 `xargs` 后面的命令进行处理

## 工作流程

`xargs` 处理的顺序是先分割，再分批，然后传递到参数位

`xargs` 中将符号分成两类：文本意义上的空格、制表符、反斜线、引号和非文本意义上的符号

- 文本意义上的空格、制表符、反斜线、引号是未经处理就已经存在的符号，例如文本的内容中出现这些符号以及在文件名上出现了这些符号都是文本意义上的

- 非文本意义的符号，是处理后出现的符号，例如 `ls` 命令的结果中每个文件之间的制表符，它原本是不存在的，只是 `ls` 命令处理后的显示方式

`xargs` 将管道传递过来的 stdin 内容的所有用来分割的空格、制表符和分行符都替换为空格并压缩到一行，这个整体可能直接交给命令或者作为 stdout 通过管道传递给管道右边的命令

{% asset_img 01.png %}

这时结果将作为整体传递，也可能被 `xargs` 同时指定的分批选项分批处理

## 使用

不指定命令时默认的命令是 `echo`

```sh
xargs [-0oprt] [-E eofstr] [-I replstr [-R replacements] [-S replsize]]
           [-J replstr] [-L number] [-n number [-x]] [-P maxprocs] [-s size]
           [utility [argument ...]]


# 分割方式
-0 使用 `\0` 作为分段符
-d 指定分段符，可以是单个符号、字母或数字，如 xargs -d "o"

# 分批方式
-n 指定每行将多少项，作为命令行参数，分割时会使用文本意义分隔符
-L 指定每行将多少项，作为命令行参数，分割时不会使用文本意义分隔符

-p 打印出要执行的命令，询问用户是否要执行
-t 打印出最终要执行的命令，然后直接执行，不需要用户确认

-i 以大括号 {} 作为替换符号
-I 指定每一项命令行参数的替代字符串

-e 解释转义字符
-P 并行处理

ls *.jpg | xargs -n1 -I {} cp {} /data/images
find . -type f -name "*.log" -print0 | xargs -0 rm -f
```

