---
toc:
  enable: true
  number: false
  max_depth: 3
title: POD 数据类型
date: 2023-05-26 19:35:48
tags: cpp
categories: cpp
---

POD(Plain Old Data) 的引入主要是为了与 c 兼容，或者说 POD 就是与 c 兼容的那部分数据类型

POD 类型同时是平凡（trivial）类型和标准布局（standard-layout）类型

一个 POD 类型的类，其非静态成员变量也必须是 POD 的，对静态成员变量和成员函数则没有这个要求

## 平凡类型

平凡类型需要同时满足：

1. 没有虚函数或虚基类

2. 由编译器生成默认的默认构造函数、拷贝构造函数、移动构造函数、赋值运算符、移动赋值运算符和析构函数

3. 成员同样需要满足条件 1 和 2

平凡类型具有如下属性：

1. 占据一块连续的内存区域

2. 由于对齐要求，成员变量之间可以填充对齐字节

3. 可以使用 `memcpy` 进行对象拷贝

4. 可以将一个平凡的类型通过 `memcpy` 放入 `char` 或者 `unsigned char` 数组，然后可以把数组内的内容重新组装成一个该类型对象

5. 允许有多个不同的访问控制符，但是在这种情况下编译器有可能对其进行重排，导致非平凡

## 标准布局类型

标准布局类型指不使用 c 中不存在的而在 cpp 中存在的某些功能或者特性

如果某个类是标准布局，那么可以通过 `memcpy` 进行复制，而且可以与 c 语言中定义的同种类型进行交互

平凡类型类型需要同时满足：

1. 没有虚函数或者虚基类

2. 没有引用类型的非静态成员变量

3. 所有的非静态成员变量具有相同的访问控制权限

4. 所有的非静态成员变量和基类都是标准布局

5. 没有多重继承导致的菱形问题

6. 子类中的第一个非静态成员的类型与其基类不同

7. 在 `class` 或者 `struct` 继承时，要么子类有非静态成员变量，要么父类有非静态成员变量

## 弃用 POD

自 cpp20 起，标准弃用了 POD 以及相应的 `std::is_pod` 和 `std::is_pod_v`